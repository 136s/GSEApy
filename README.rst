GSEAPY
========

Gseapy is a python wrapper for **GESA**. 

`Gene Set Enrichment Analysis <http://software.broadinstitute.org/gsea/index.jsp>`_ (GSEA) 
is a computational method that determines whether an a priori defined set of genes shows 
statistically significant, concordant differences between two biological states (e.g. phenotypes). 

The full ``GSEA`` is far too extensive to describe here; see
`GSEA  <http://www.broadinstitute.org/cancer/software/gsea/wiki/index.php/Main_Page>`_ documentation for more information.


However, the R version of GSEA had not been updated since 2006. 
Although the best choice of GSEA is the desktop Java version, this version did not provide means to 
modify plots, like legends, ticks......


GSEAPY is aim to become a python wrapper of GSEA. It is used for convenient GO 
enrichments and produce **publishable quality figures** from python. For use in ``python`` projects.



**Features of GSEAPY**

#. Reproduce the GSEA plot from GSEA desktop version.

#. Statistical testing module which is identical to ``GSEA`` Desktop version.

#. Enhancement of ``GSEA`` will be considered. If you would like to contribute, please @BioNinja on ``Github``. 



GSEA desktop version output: 
-------------------------------------------------
This is an example of GSEA desktop application output

.. figure:: GSEA_OCT4_KD.png

    Generated by ``GSEA`` desktop version


gseapy output
-----------------------------------------------
Using the same algorithm by ``GSEA``, gseapy reproduce the example above.

.. figure:: gseapy_OCT4_KD.png

   
   
   Generated by gseapy
   
   **GSEAPY plots are in PDF formats.**

   You can modify ``GSEA`` plots easily in .pdf files. Please Enjoy.



Installation
------------

| Install package from pypi and download 

.. code:: shell

   $ pip install gseapy

| You may instead want to use the development version from Github, by running

.. code:: shell

   $ pip install git+git://github.com/BioNinja/gseapy.git#egg=gseapy

Dependency
--------------
* Python 2.7 or 3.3+

Mandatory
~~~~~~~~~

* Numpy 
* Pandas 
* Matplotlib
* Beautifulsoup4

You may also need **lxml, html5lib**, if you could not parse xml files. 


   
Run GSEAPY
-----------------

| Gseapy has two subcommands: ``replot``, ``call``.
| ``replot`` command will parse the GSEA desktop output directory. 
| ``call`` command will compute es,nes,pval,fdr and generates plots.


| For more details,see below. 





To see GSEAPY sub-commands.
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.. code:: shell
   
   $ gseapy --help 
   
    usage: gseapy [-h] [--version] {call,replot} ...

    gseapy -- GSEAPY for Gene Set Enrichment Analysis

    positional arguments:
      {call,replot}
        call       Main GSEAPY Function: run GSEAPY instead of GSEA.
        replot       Reproduce GSEA desktop figures.

    optional arguments:
      -h, --help   show this help message and exit
      --version    show program's version number and exit



For command line options of each command, type: gseapy COMMAND -h


The ``replot`` module
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. code:: shell

   $ gseapy replot -h

   usage: gseapy replot [-h] -i  [-w] [-o] [-f] [--figsize width height]

    optional arguments:
      -h, --help            show this help message and exit
      -i , --indir          The GSEA desktop results directroy that you want to
                            reproduce the figure
      -w , --weight         Weighted_score type of rank_metrics.Choose from (0, 1,
                            1.5, 2),default: 1
      -o , --outdir         The gseapy output directory. Default: the current
                            working directory
      -f , --format         Format of output figures, choose from {'pdf', 'png',
                            'jpeg', 'eps'}
      --figsize width height
                            The figsize keyword argument need two parameter to
                            define. Default: [6.5,6]



The ``call`` module
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. code:: shell

   $ gseapy call -h

    usage: gseapy call [-h] -i DATA -c CLS -g GMT [-p] [-o] [-f]
                    [--figsize width height] [--min_size] [--max_size] [-n]
                    [-w] [-m] [-a]

    optional arguments:
      -h, --help            show this help message and exit

    Input files arguments:
      -i DATA, --indata DATA
                            Expression table of phenotypes. Expected a txt
                            file.Same with GSEA.
      -c CLS, --cls CLS     cls files. same with GSEA.
      -g GMT, --gmt GMT     Gene Sets in gmt format. same with GSEA.
      -p , --permutation-type
                            Gene Sets in gmt format. same with GSEA, choose from
                            {'gene_set', 'phenotype'}
    
    Output arguments:
      -o , --outdir         The gseapy output directory. Default: the current
                            working directory
      -f , --format         Format of output figures, choose from {'pdf', 'png',
                            'jpeg', 'eps'}
      --figsize width height
                            The figsize keyword argument need two parameter to
                            define. Default: [6.5,6]
    
    GSEA advance arguments:
      --min_size            Min size of gene sets. Default: 15
      --max_size            Max size of gene sets. Default: 1000
      -n , --permutation_n
                            permutation number. Default: 1000
      -w , --weight         Weighted_score type of rank_metrics.Choose from {0, 1,
                            1.5, 2},default: 1
      -m , --method         methods to calculate correlations of ranking metrics
      -a, --ascending       Rank metrice acendings. True or False. Default: False.



    
For commandline usage:
~~~~~~~~~~~~~~~~~~~~~~~

.. code:: shell
  
  $ gseapy replot -i path/to/gsea_edb_file_location -o gesapy_out

  # example
  $ gseapy replot -i data -o test



Run gseapy inside python:
~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. code:: python
  
   import gseapy
   # reproduce plots from GSEA ouput
   gseapy.replot('data','test')

   # calculate es, nes, pval,fdrs, and produce figures using gseapy.
   gseapy.run(data, gene_sets,cls, min_size, max_size, permutation_n, weighted_score_type,
             permutation_type, method,ascending, outdir,figsize)






   
